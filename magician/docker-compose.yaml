services:
  magician_service:
    build:
      context: ..
      dockerfile: magician/Dockerfile
    container_name: magician_service
    restart: always
    env_file:
      - .env
      - ../.env
    depends_on:
      kafka-1:
        condition: service_healthy
      kafka-2:
        condition: service_healthy
      kafka-3:
        condition: service_healthy
      scavenger_service:
        condition: service_started
    environment:
      SCAVENGER_BASE_URL: ${SCAVENGER_BASE_URL}
      SCAVENGER_TIMEOUT_SECS: ${SCAVENGER_TIMEOUT_SECS}
      API_PORT: ${API_PORT}
      KAFKA_FORECAST_REQUEST_TOPIC: ${KAFKA_FORECAST_REQUEST_TOPIC}
      KAFKA_FORECAST_RESPONSE_TOPIC: ${KAFKA_FORECAST_RESPONSE_TOPIC}
    ports:
      - ${API_PORT}:${API_PORT}
    volumes:
      - .:/home/magician_admin/app/magician
      - ../utils:/home/magician_admin/app/utils
